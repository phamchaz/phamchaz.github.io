<head>

<script type="text/javascript"> (function(a,b,c,d,e,f,g){e['ire_o']=c;e[c]=e[c]||function(){(e[c].a=e[c].a||[]).push(arguments)};f=d.createElement(b);g=d.getElementsByTagName(b)[0];f.async=1;f.src=a;g.parentNode.insertBefore(f,g);})('https://utt.impactcdn.com/A5398153-297a-42e2-b41d-c402f107dff665535.js','script','ire',document,window); ire('identify', {customerid: '' /*INSERT CUSTOMER ID*/, customeremail: '' /*INSERT SHA1 HASHED CUSTOMER EMAIL*/}); </script>

</head>

<body>

<strong>Usage Guide</strong>

<p>The page gets displayed once a user has signed up, which will trigger the "Register Participants" event.  </p>

<p>Brands will need to capture the Referee's details and use that to generate a JWT from the backend and send through to the JS code on this page. </p>
<p> Note: Creating a JWT requires the client’s Read/Write Auth Token, the function for creating a JWT should exist only in a backend environment to prevent malicious actors from obtaining a client’s Auth Token. </p>

<p>The JS code firing on this page has a JWT value hardcoded </p>

<p>The Referee is being credited based on the first-party cookie dropped by the UTT </p>
  
  <script>
  // 1. When squatch.js is ready, run the following function.
  window.impactOnReady = function(){
    // 2. Configure squatch-js for your user and widget.
    //  The information provided here is used to track your user and register them in Advocate
    //  This request is authenticated via JWT
    //  A note about generating JWTs:
    //    JWT's are tokens that are signed with your tenant API key. They must be generated server-side.
    //    To ensure the security of your tenant and program, do not expose your tenant API key to your frontend
    //    For more information see https://integrations.impact.com/impact-brand/docs/json-web-tokens
    const userConfig = {
        // 2b. Add details about your user
        //  This must include id and account id but other fields such as email, first name, locale or even custom fields can be included
        //  For more details and a list of user fields see https://integrations.impact.com/impact-brand/docs/install-the-utt
        user: {                               
        id: 'api1@referred.com',                      
        accountId: 'api1@referred.com',       
        email: 'api1@referred.com',      
        firstName: 'Api1',
    		lastName: 'Test1',
        //referredByCodes: ["CHARLESTEST"],
        },
        // 2c. Add your generated JWT here to authenticate your request
        jwt:'eyJhbGciOiJIUzI1NiIsImtpZCI6IklSVXRYZVJadm5IcjUzOTgxNTNMUzdlTkp1WGZlNjU1MzUifQ.eyJ1c2VyIjp7ImlkIjoiYXBpMUByZWZlcnJlZC5jb20iLCJhY2NvdW50SWQiOiJhcGkxQHJlZmVycmVkLmNvbSIsImZpcnN0TmFtZSI6IkFwaTEiLCJsYXN0TmFtZSI6IlRlc3QxIiwiZW1haWwiOiJhcGkxQHRlc3QuY29tIn19.BTA51vVKRnAoZKTmvoDO_5e2-0L4xaf9-NnCKeWVCvQ'
    };
    // 3. Make the request to upsert your user.

    impact.api().upsertUser(userConfig).then(function(response) {
        // The widget API automatically inserts the HTML for your widget into your page via an iFrame
        // However if needed, you can retrieve details about the upserted user and the widget HTML through this function response
        const user = response.user;
    }).catch(function(error){
        console.log(error);
    });
  };
</script>
<a href="https://phamchaz.github.io/referee_sale.html">Click here to trigger the Online Sale event</a>
  
</body>
